<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Accessible Grievance Reporting</title>
    <link rel="stylesheet" href="/shared/styles/common.css">
    <link rel="stylesheet" href="/accessible/styles.css">
    <link rel="apple-touch-icon" sizes="180x180" href="/shared/images/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/shared/images/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/shared/images/favicon-16x16.png">
    <link rel="manifest" href="/shared/images/site.webmanifest">
    <meta name="description" content="Accessible grievance reporting system for the Department of Roads, Nepal">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
</head>
<body>
    <a href="#main" class="skip-link">Skip to main content</a>

    <div class="container">
        <header>
            <div class="header-content">
                <img src="/shared/images/DOR-logo.png" alt="Department of Roads Logo" width="50">
                <h1>Accessible Grievance Reporting</h1>
                <div class="language-selector">
                    <select id="languageSelect" aria-label="Select language">
                        <option value="en" selected>English</option>
                        <option value="ne">‡§®‡•á‡§™‡§æ‡§≤‡•Ä (Nepali)</option>
                        <option value="hi">‡§π‡§ø‡§Ç‡§¶‡•Ä (Hindi)</option>
                        <option value="fr">Fran√ßais (French)</option>
                    </select>
                </div>
            </div>
        </header>

        <!-- Speech rate dropdown that appears when speed button is clicked -->
        <div id="speedDropdown" class="speed-dropdown" hidden>
            <div class="speed-option" data-rate="0.6">0.6x</div>
            <div class="speed-option" data-rate="0.85">0.85x</div>
            <div class="speed-option selected" data-rate="1">1x</div>
            <div class="speed-option" data-rate="1.25">1.25x</div>
            <div class="speed-option" data-rate="1.5">1.5x</div>
        </div>

        <main id="main">
            <!-- Step 1: Grievance Details -->
            <div id="grievance-grievanceDetails" class="step" role="region" aria-label="Grievance: Grievance Details">
                <h2>Step 1: Grievance</h2><h3 style="display: inline; font-weight: normal;">‚Äì Grievance Details</h3>
                <div class="content">
                    <div class="nav-row">
                        <button class="nav-btn" data-action="prev" aria-label="Previous step" disabled>
                            <i class="fas fa-chevron-left"></i>
                            <span class="tooltip">Previous</span>
                        </button>
                        <button id="recordBtn-grievance-grievanceDetails" class="record-btn" aria-label="Record your grievance" type="button">Record</button>
                        <button class="nav-btn" data-action="next" aria-label="Next step" disabled>
                            <i class="fas fa-chevron-right"></i>
                            <span class="tooltip">Next</span>
                        </button>
                    </div>
                    <div class="instruction-row" id="instruction-grievance-grievanceDetails">
                        <p class="step-instruction">Please explain your grievance related to roads or transportation.</p>
                    </div>
                    <div class="info-row" id="info-grievance-grievanceDetails">
                        <div id="status-grievance-grievanceDetails" class="status" hidden>Recording: <span>0:00</span></div>
                    </div>
                    <div class="playback-row-container">
                        <div id="playback-grievance-grievanceDetails" class="playback" hidden>
                            <div class="playback-row">
                                <button class="nav-btn" data-action="retry" aria-label="Retry recording">
                                    <i class="fas fa-undo"></i>
                                    <span class="tooltip">Retry</span>
                                </button>
                                <audio controls></audio>
                                <button class="nav-btn" data-action="continue" aria-label="Continue to next step">
                                    <i class="fas fa-chevron-right"></i>
                                    <span class="tooltip">Continue</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 2: Personal Info - Full Name -->
            <div id="personalInfo-fullName" class="step" hidden role="region" aria-label="Personal Info: Full Name">
                <h2>Step 2: Personal Info</h2><h3 style="display: inline; font-weight: normal;">‚Äì Full Name</h3>
                <div class="content">
                    <div class="nav-row">
                        <button class="nav-btn" data-action="prev" aria-label="Previous step">
                            <i class="fas fa-chevron-left"></i>
                            <span class="tooltip">Previous</span>
                        </button>
                        <button id="recordBtn-personalInfo-fullName" class="record-btn" aria-label="Record your full name" type="button">Record</button>
                        <button class="nav-btn" data-action="next" aria-label="Next step" disabled>
                            <i class="fas fa-chevron-right"></i>
                            <span class="tooltip">Next</span>
                        </button>
                    </div>
                    <div class="instruction-row" id="instruction-personalInfo-fullName">
                        <p class="step-instruction">Please state your full name.</p>
                    </div>
                    <div class="info-row" id="info-personalInfo-fullName">
                        <div id="status-personalInfo-fullName" class="status" hidden>Recording: <span>0:00</span></div>
                    </div>
                    <div class="playback-row-container">
                        <div id="playback-personalInfo-fullName" class="playback" hidden>
                            <div class="playback-row">
                                <button class="nav-btn" data-action="retry" aria-label="Retry recording">
                                    <i class="fas fa-undo"></i>
                                    <span class="tooltip">Retry</span>
                                </button>
                                <audio controls></audio>
                                <button class="nav-btn" data-action="continue" aria-label="Continue to next step">
                                    <i class="fas fa-chevron-right"></i>
                                    <span class="tooltip">Continue</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 2: Personal Info - Phone -->
            <div id="personalInfo-phone" class="step" hidden role="region" aria-label="Personal Info: Phone">
                <h2>Step 2: Personal Info</h2><h3 style="display: inline; font-weight: normal;">‚Äì Phone</h3>
                <div class="content">
                    <div class="nav-row">
                        <button class="nav-btn" data-action="prev" aria-label="Previous step">
                            <i class="fas fa-chevron-left"></i>
                            <span class="tooltip">Previous</span>
                        </button>
                        <button id="recordBtn-personalInfo-phone" class="record-btn" aria-label="Record your phone number" type="button">Record</button>
                        <button class="nav-btn" data-action="next" aria-label="Next step" disabled>
                            <i class="fas fa-chevron-right"></i>
                            <span class="tooltip">Next</span>
                        </button>
                    </div>
                    <div class="instruction-row" id="instruction-personalInfo-phone">
                        <p class="step-instruction">Please state your phone number.</p>
                    </div>
                    <div class="info-row" id="info-personalInfo-phone">
                        <div id="status-personalInfo-phone" class="status" hidden>Recording: <span>0:00</span></div>
                    </div>
                    <div class="playback-row-container">
                        <div id="playback-personalInfo-phone" class="playback" hidden>
                            <div class="playback-row">
                                <button class="nav-btn" data-action="retry" aria-label="Retry recording">
                                    <i class="fas fa-undo"></i>
                                    <span class="tooltip">Retry</span>
                                </button>
                                <audio controls></audio>
                                <button class="nav-btn" data-action="continue" aria-label="Continue to next step">
                                    <i class="fas fa-chevron-right"></i>
                                    <span class="tooltip">Continue</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 2: Personal Info - Municipality -->
            <div id="personalInfo-municipality" class="step" hidden role="region" aria-label="Personal Info: Municipality">
                <h2>Step 2: Personal Info</h2><h3 style="display: inline; font-weight: normal;">‚Äì Municipality</h3>
                <div class="content">
                    <div class="nav-row">
                        <button class="nav-btn" data-action="prev" aria-label="Previous step">
                            <i class="fas fa-chevron-left"></i>
                            <span class="tooltip">Previous</span>
                        </button>
                        <button id="recordBtn-personalInfo-municipality" class="record-btn" aria-label="Record your municipality" type="button">Record</button>
                        <button class="nav-btn" data-action="next" aria-label="Next step" disabled>
                            <i class="fas fa-chevron-right"></i>
                            <span class="tooltip">Next</span>
                        </button>
                    </div>
                    <div class="instruction-row" id="instruction-personalInfo-municipality">
                        <p class="step-instruction">Please state your municipality.</p>
                    </div>
                    <div class="info-row" id="info-personalInfo-municipality">
                        <div id="status-personalInfo-municipality" class="status" hidden>Recording: <span>0:00</span></div>
                    </div>
                    <div class="playback-row-container">
                        <div id="playback-personalInfo-municipality" class="playback" hidden>
                            <div class="playback-row">
                                <button class="nav-btn" data-action="retry" aria-label="Retry recording">
                                    <i class="fas fa-undo"></i>
                                    <span class="tooltip">Retry</span>
                                </button>
                                <audio controls></audio>
                                <button class="nav-btn" data-action="continue" aria-label="Continue to next step">
                                    <i class="fas fa-chevron-right"></i>
                                    <span class="tooltip">Continue</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 2: Personal Info - Village -->
            <div id="personalInfo-village" class="step" hidden role="region" aria-label="Personal Info: Village">
                <h2>Step 2: Personal Info</h2><h3 style="display: inline; font-weight: normal;">‚Äì Village</h3>
                <div class="content">
                    <div class="nav-row">
                        <button class="nav-btn" data-action="prev" aria-label="Previous step">
                            <i class="fas fa-chevron-left"></i>
                            <span class="tooltip">Previous</span>
                        </button>
                        <button id="recordBtn-personalInfo-village" class="record-btn" aria-label="Record your village" type="button">Record</button>
                        <button class="nav-btn" data-action="next" aria-label="Next step" disabled>
                            <i class="fas fa-chevron-right"></i>
                            <span class="tooltip">Next</span>
                        </button>
                    </div>
                    <div class="instruction-row" id="instruction-personalInfo-village">
                        <p class="step-instruction">Please state your village name.</p>
                    </div>
                    <div class="info-row" id="info-personalInfo-village">
                        <div id="status-personalInfo-village" class="status" hidden>Recording: <span>0:00</span></div>
                    </div>
                    <div class="playback-row-container">
                        <div id="playback-personalInfo-village" class="playback" hidden>
                            <div class="playback-row">
                                <button class="nav-btn" data-action="retry" aria-label="Retry recording">
                                    <i class="fas fa-undo"></i>
                                    <span class="tooltip">Retry</span>
                                </button>
                                <audio controls></audio>
                                <button class="nav-btn" data-action="continue" aria-label="Continue to next step">
                                    <i class="fas fa-chevron-right"></i>
                                    <span class="tooltip">Continue</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 2: Personal Info - Address -->
            <div id="personalInfo-address" class="step" hidden role="region" aria-label="Personal Info: Address">
                <h2>Step 2: Personal Info</h2><h3 style="display: inline; font-weight: normal;">‚Äì Address</h3>
                <div class="content">
                    <div class="nav-row">
                        <button class="nav-btn" data-action="prev" aria-label="Previous step">
                            <i class="fas fa-chevron-left"></i>
                            <span class="tooltip">Previous</span>
                        </button>
                        <button id="recordBtn-personalInfo-address" class="record-btn" aria-label="Record your street address" type="button">Record</button>
                        <button class="nav-btn" data-action="next" aria-label="Next step" disabled>
                            <i class="fas fa-chevron-right"></i>
                            <span class="tooltip">Next</span>
                        </button>
                        <button id="submitGrievanceBtn" class="nav-btn" data-action="submit" aria-label="Submit your grievance" type="button">
                            <i class="fas fa-check"></i>
                            <span class="tooltip">Submit</span>
                        </button>
                    </div>
                    <div class="instruction-row" id="instruction-personalInfo-address">
                        <p class="step-instruction">Please state your street address or location details.</p>
                    </div>
                    <div class="info-row" id="info-personalInfo-address">
                        <div id="status-personalInfo-address" class="status" hidden>Recording: <span>0:00</span></div>
                    </div>
                    <div class="playback-row-container">
                        <div id="playback-personalInfo-address" class="playback" hidden>
                            <div class="playback-row">
                                <button class="nav-btn" data-action="retry" aria-label="Retry recording">
                                    <i class="fas fa-undo"></i>
                                    <span class="tooltip">Retry</span>
                                </button>
                                <audio controls></audio>
                                <button class="nav-btn" data-action="continue" aria-label="Continue to next step" disabled>
                                    <i class="fas fa-chevron-right"></i>
                                    <span class="tooltip">Continue</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Attachment Step -->
            <div id="attachments-attachments" class="step" hidden role="region" aria-label="attachments-attachments">
                <h2>Step 3: Attachment</h2>
                <div class="content">
                    
                    <!-- Success Message and Grievance ID -->
                    <div class="confirmation-message">
                        <h4 id="confirmation-heading">Voice Grievance Submitted</h4>
                        <p id="resultMessage">Your voice recordings have been submitted successfully.</p>
                        <p>Your grievance ID is </p><h4 id="grievanceId"><span></span></h4>
                        <p>Please save this ID for your reference.</p>
                        <p>You can now review your transcript and attach supporting documents to your grievance.</p>
                    </div>
                    <div class="nav-row">
                        <button class="nav-btn" data-action="prev" aria-label="Previous step">
                            <i class="fas fa-chevron-left"></i>
                            <span class="tooltip">Previous</span>
                        </button>
                        <button class="nav-btn" data-action="next" aria-label="Next step" disabled>
                            <i class="fas fa-chevron-right"></i>
                            <span class="tooltip">Next</span>
                        </button>
                    </div>
                    <!-- Attachment Section -->
                    <div class="attachment-instructions" id="attachmentInstructions">
                        <h4>Attach your files</h4>
                        <p>You can attach photos or documents to provide more details about your grievance.</p>
                        <p>This step is optional but recommended to help us better understand your issue.</p>
                        <div class="button-container">
                            <button id="attachFilesBtn" class="secondary-btn" aria-label="Attach photos or documents" type="button">Attach Files</button>
                        </div>
                    </div>
                    
                    <div class="file-upload-container">
                        <input type="file" id="fileInput" multiple accept="image/*,application/pdf,video/*,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.txt" hidden>
                        <div id="fileList" class="file-list" hidden>
                            <h3>Selected Files:</h3>
                            <ul></ul>
                            <button id="submitFilesBtn" class="secondary-btn" aria-label="Submit your selected files" type="button">Submit Files</button>
                        </div>
                    </div>
                    
                    <div id="uploadedFilesSection" class="uploaded-files-section" hidden>
                        <h3>Uploaded Files</h3>
                        <div id="uploadedFilesList" class="uploaded-files-list">
                            <ul></ul>
                        </div>
                        <p class="upload-success-message" id="uploadSuccessMessage">Files uploaded successfully!</p>
                        <div class="button-container">
                            <button id="attachMoreBtn" class="secondary-btn" aria-label="Attach more files" type="button">Attach More Files</button>
                        </div>
                    </div>
                    <div class="button-container">
                        <button id="newBtn" class="primary-btn" data-action="new" aria-label="Start a new grievance report" type="button">New Grievance</button>
                        <button id="exitBtn" class="exit-btn" data-action="exit" aria-label="Exit application" type="button">Exit</button>
                    </div>
                </div>
            </div>
                <!-- Review Steps -->
            <div id="review-reviewGrievance" class="step" hidden role="region" aria-label="review-reviewGrievance">
                <div class="review-steps">
                    <h2>Step 4: Review</h2><h3 style="display: inline; font-weight: normal;">‚Äì Grievance Details</h3>
                    <div class="review-content">
                        <div class="nav-row">
                            <button class="nav-btn" data-action="prev" aria-label="Previous step">
                                <i class="fas fa-chevron-left"></i>
                                <span class="tooltip">Previous</span>
                            </button>
                            <button class="nav-btn" data-action="next" aria-label="Next step" disabled>
                                <i class="fas fa-chevron-right"></i>
                                <span class="tooltip">Next</span>
                            </button>
                        </div>
                        <!-- Grievance Details -->
                        <div class="review-section">
                            <h4>Grievance Details</h4>
                            <div class="review-text" id="grievanceDetailsReview"></div>
                            <button data-recording-type="grievance_details" class="modify-btn primary-btn" aria-label="Modify recording">
                                <i class="fas fa-edit"></i> Modify Recording
                            </button>
                        </div>

                        <!-- Grievance Summary -->
                        <div class="review-section">
                            <h4>Grievance Summary</h4>
                            <div class="review-text" id="grievanceSummaryReview"></div>
                            <button data-recording-type="grievance_summary" class="modify-btn primary-btn" aria-label="Modify recording">
                                <i class="fas fa-edit"></i> Modify Recording
                            </button>
                        </div>

                        <!-- Grievance Categories -->
                        <div class="review-section">
                            <h4>Grievance Categories</h4>
                            <div class="review-text" id="grievanceCategoriesReview"></div>
                            <button data-action="show-categories" class="modify-btn primary-btn" aria-label="Show categories">
                                <i class="fas fa-edit"></i> Modify Categories
                            </button>
                            <div id="categoriesDropdown" class="dropdown-content" hidden>
                                <!-- Categories will be populated from LIST_OF_CATEGORIES -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 2: Personal Information Review -->
            <div id="review-reviewDetails" class="step" hidden role="region" aria-label="review-reviewDetails">
                <div class="review-steps">
                    
                    <h2>Step 4: Review</h2><h3 style="display: inline; font-weight: normal;">‚Äì Personal Info</h3>
                    <div class="review-content">
                        <div class="nav-row">
                            <button class="nav-btn" data-action="prev" aria-label="Previous step">
                                <i class="fas fa-chevron-left"></i>
                                <span class="tooltip">Previous</span>
                            </button>
                            <button class="nav-btn" data-action="next" aria-label="Next step" disabled>
                                <i class="fas fa-chevron-right"></i>
                                <span class="tooltip">Next</span>
                            </button>
                        </div>
                        <!-- Full Name -->
                        <div class="review-section">
                            <h4>Full Name</h4>
                            <div class="review-text" id="userNameReview"></div>
                            <button data-recording-type="user_full_name" class="modify-btn primary-btn" aria-label="Modify recording">
                                <i class="fas fa-edit"></i> Modify Recording
                            </button>
                        </div>

                        <!-- Phone Number -->
                        <div class="review-section">
                            <h4>Phone Number</h4>
                            <div class="review-text" id="userPhoneReview"></div>
                            <button data-recording-type="user_contact_phone" class="modify-btn primary-btn" aria-label="Modify recording">
                                <i class="fas fa-edit"></i> Modify Recording
                            </button>
                        </div>
                        <!-- Municipality -->
                        <div class="review-section">
                            <h4>Municipality</h4>
                            <div class="review-text" id="userMunicipalityReview"></div>
                            <button data-recording-type="user_municipality" class="modify-btn primary-btn" aria-label="Modify recording">
                                <i class="fas fa-edit"></i> Modify Recording
                            </button>
                        </div>

                        <!-- Village -->
                        <div class="review-section">
                            <h4>Village</h4>
                            <div class="review-text" id="userVillageReview"></div>
                            <button data-recording-type="user_village" class="modify-btn primary-btn" aria-label="Modify recording">
                                <i class="fas fa-edit"></i> Modify Recording
                            </button>
                        </div>

                        <!-- Address -->
                        <div class="review-section">
                            <h4>Address / Landmark</h4>
                            <div class="review-text" id="userAddressReview"></div>
                            <button data-recording-type="user_address" class="modify-btn primary-btn" aria-label="Modify recording">
                                <i class="fas fa-edit"></i> Modify Recording
                            </button>
                        </div>
                    </div>
                    <!-- Navigation Buttons -->
                    <div class="review-navigation">
                        <button class="nav-btn" data-action="prev" aria-label="Previous step" disabled>
                            <i class="fas fa-chevron-left"></i>
                            <span class="tooltip">Previous</span>
                        </button>
                        <button class="nav-btn" data-action="next" aria-label="Next step">
                            <i class="fas fa-chevron-right"></i>
                            <span class="tooltip">Next</span>
                        </button>
                    </div>
                </div>



        <!-- Ensure the help dialog is properly set up to work with showModal() -->
        <dialog id="helpDialog" aria-labelledby="helpDialogHeading">
            <h2 id="helpDialogHeading">Help & Instructions</h2>
            <p>Record your grievance in these steps:</p>
            <ol>
                <li>Explain your grievance</li>
                <li>Provide your full name</li>
                <li>Provide your phone number</li>
                <li>State your municipality</li>
                <li>State your village</li>
                <li>State your street address</li>
                <li>Submit your grievance</li>
                <li>Optionally attach supporting files</li>
            </ol>
            <p>Accessibility features available:</p>
            <ul>
                <li>Use the "Read Aloud" button (üîä) to hear page contents</li>
                <li>Change speech rate with the "1x" button</li>
                <li>Increase font size with the "Aa" button</li>
                <li>Toggle high contrast mode with the contrast button (‚óê)</li>
            </ul>
            <button class="primary-btn" aria-label="Close help dialog" type="button">Close</button>
        </dialog>
        
        <!-- Screen Reader Enable Dialog -->
        <dialog id="screenReaderDialog" aria-labelledby="screenReaderDialogHeading">
            <h2 id="screenReaderDialogHeading">Enable Screen Reader?</h2>
            <p>Would you like to enable the Screen Reader (Read Aloud) feature for this session? This will allow the app to read instructions aloud for each step.</p>
            <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                <button id="enableScreenReaderBtn" class="primary-btn" aria-label="Enable screen reader">Enable</button>
                <button id="disableScreenReaderBtn" class="secondary-btn" aria-label="Do not enable screen reader">Not Now</button>
            </div>
        </dialog>
        
        <footer>
            <div class="footer-content">
                <p>&copy; 2025 Department of Roads, Nepal. All rights reserved.</p>
                
                <!-- Accessibility Toolbar in Footer -->
                <div class="accessibility-toolbar" role="toolbar" aria-label="Accessibility controls">
                    <button id="contrastToggleBtn" class="a11y-btn contrast-btn" aria-label="Toggle high contrast mode" type="button">
                        <span class="icon" aria-hidden="true">‚óê</span>
                    </button>
                    
                    <button id="fontSizeBtn" class="a11y-btn font-btn" aria-label="Increase font size" type="button">
                        <span class="icon" aria-hidden="true">Aa</span>
                    </button>
                    
                    <button id="readPageBtn" class="a11y-btn read-btn" aria-label="Read page content aloud" type="button">
                        <span class="icon" aria-hidden="true">üîä</span>
                    </button>
                    
                    <button id="speedBtn" class="a11y-btn speed-btn" aria-label="Change speech rate" type="button">
                        <span class="icon" aria-hidden="true">1x</span>
                    </button>
                    
                    <button id="helpBtn" class="a11y-btn help-btn" aria-label="Show help and instructions" type="button">
                        <span class="icon" aria-hidden="true">?</span>
                    </button>
                </div>
            </div>
        </footer>

        <!-- Add after the main content, before the footer -->
        <div id="submissionOverlay" class="submission-overlay" hidden data-debug="submission-overlay">
            <div class="submission-content">
                <div class="spinner"></div>
                <div class="submission-message">Submitting your grievance‚Ä¶</div>
                <button id="cancelSubmissionBtn" class="secondary-btn" style="display:none; margin-top:20px;">Cancel</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.socket.io/4.7.4/socket.io.min.js"></script>
    <script src="/shared/scripts/utils.js"></script>
    <script src="/accessible/config.js"></script>
    <script src="/accessible/app.js"></script>
</body>
</html> 
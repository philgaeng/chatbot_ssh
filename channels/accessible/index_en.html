<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Accessible Grievance Reporting</title>
    <link rel="stylesheet" href="/shared/styles/common.css">
    <link rel="stylesheet" href="/accessible/styles.css">
    <link rel="apple-touch-icon" sizes="180x180" href="/shared/images/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/shared/images/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/shared/images/favicon-16x16.png">
    <link rel="manifest" href="/shared/images/site.webmanifest">
    <meta name="description" content="Accessible grievance reporting system for the Department of Roads, Nepal">
</head>
<body>
    <a href="#main" class="skip-link">Skip to main content</a>

    <div class="container">
        <header>
            <div class="header-content">
                <img src="/shared/images/DOR-logo.png" alt="Department of Roads Logo" width="50">
                <h1>Accessible Grievance Reporting</h1>
            </div>
        </header>

        <!-- Speech rate dropdown that appears when speed button is clicked -->
        <div id="speedDropdown" class="speed-dropdown" hidden>
            <div class="speed-option" data-rate="0.6">0.6x</div>
            <div class="speed-option" data-rate="0.85">0.85x</div>
            <div class="speed-option selected" data-rate="1">1x</div>
            <div class="speed-option" data-rate="1.25">1.25x</div>
            <div class="speed-option" data-rate="1.5">1.5x</div>
        </div>

        <main id="main">
            <!-- Voice Grievance Form -->
            <form id="grievanceForm" method="post" action="javascript:void(0);">
                <div id="step1" class="step" role="region" aria-labelledby="step1-heading">
                    <h2 id="step1-heading">Step 1: Record Your Grievance</h2>
                    <div class="content">
                        <p>Please explain your grievance related to roads or transportation.</p>
                        <button id="recordBtn1" class="record-btn" aria-label="Record your grievance" type="button">Record Grievance</button>
                        <button class="skip-btn secondary-btn" aria-label="Skip this step" type="button">Skip</button>
                        <div id="status1" class="status" hidden>Recording: <span>0:00</span></div>
                        <div id="playback1" class="playback" hidden>
                            <audio controls></audio>
                            <button class="retry-btn secondary-btn" aria-label="Retry recording your grievance" type="button">Retry</button>
                            <button class="next-btn primary-btn" aria-label="Continue to next step" type="button">Continue</button>
                        </div>
                    </div>
                </div>

                <!-- Split Step 2 into two parts -->
                <div id="step2a" class="step" hidden role="region" aria-labelledby="step2a-heading">
                    <h2 id="step2a-heading">Step 2A: Your Name</h2>
                    <div class="content">
                        <p>Please state your full name.</p>
                        <button id="recordBtn2a" class="record-btn" aria-label="Record your full name" type="button">Record</button>
                        <button class="skip-btn secondary-btn" aria-label="Skip this step" type="button">Skip</button>
                        <div id="status2a" class="status" hidden>Recording: <span>0:00</span></div>
                        <div id="playback2a" class="playback" hidden>
                            <audio controls></audio>
                            <button class="retry-btn secondary-btn" aria-label="Retry recording your name" type="button">Retry</button>
                            <button class="next-btn primary-btn" aria-label="Continue to next step" type="button">Continue</button>
                        </div>
                    </div>
                </div>

                <div id="step2b" class="step" hidden role="region" aria-labelledby="step2b-heading">
                    <h2 id="step2b-heading">Step 2B: Contact Number</h2>
                    <div class="content">
                        <p>Please state your phone number.</p>
                        <button id="recordBtn2b" class="record-btn" aria-label="Record your phone number" type="button">Record</button>
                        <button class="skip-btn secondary-btn" aria-label="Skip this step" type="button">Skip</button>
                        <div id="status2b" class="status" hidden>Recording: <span>0:00</span></div>
                        <div id="playback2b" class="playback" hidden>
                            <audio controls></audio>
                            <button class="retry-btn secondary-btn" aria-label="Retry recording your phone number" type="button">Retry</button>
                            <button class="next-btn primary-btn" aria-label="Continue to next step" type="button">Continue</button>
                        </div>
                    </div>
                </div>

                <!-- Split Step 3 into three parts -->
                <div id="step3a" class="step" hidden role="region" aria-labelledby="step3a-heading">
                    <h2 id="step3a-heading">Step 3A: Municipality</h2>
                    <div class="content">
                        <p>Please state your municipality.</p>
                        <button id="recordBtn3a" class="record-btn" aria-label="Record your municipality" type="button">Record</button>
                        <button class="skip-btn secondary-btn" aria-label="Skip this step" type="button">Skip</button>
                        <div id="status3a" class="status" hidden>Recording: <span>0:00</span></div>
                        <div id="playback3a" class="playback" hidden>
                            <audio controls></audio>
                            <button class="retry-btn secondary-btn" aria-label="Retry recording your municipality" type="button">Retry</button>
                            <button class="next-btn primary-btn" aria-label="Continue to next step" type="button">Continue</button>
                        </div>
                    </div>
                </div>

                <div id="step3b" class="step" hidden role="region" aria-labelledby="step3b-heading">
                    <h2 id="step3b-heading">Step 3B: Village</h2>
                    <div class="content">
                        <p>Please state your village name.</p>
                        <button id="recordBtn3b" class="record-btn" aria-label="Record your village" type="button">Record</button>
                        <button class="skip-btn secondary-btn" aria-label="Skip this step" type="button">Skip</button>
                        <div id="status3b" class="status" hidden>Recording: <span>0:00</span></div>
                        <div id="playback3b" class="playback" hidden>
                            <audio controls></audio>
                            <button class="retry-btn secondary-btn" aria-label="Retry recording your village" type="button">Retry</button>
                            <button class="next-btn primary-btn" aria-label="Continue to next step" type="button">Continue</button>
                        </div>
                    </div>
                </div>

                <div id="step3c" class="step" hidden role="region" aria-labelledby="step3c-heading">
                    <h2 id="step3c-heading">Step 3C: Street Address</h2>
                    <div class="content">
                        <p>Please state your street address or location details.</p>
                        <button id="recordBtn3c" class="record-btn" aria-label="Record your street address" type="button">Record</button>
                        <button class="skip-btn secondary-btn" aria-label="Skip this step" type="button">Skip</button>
                        <div id="status3c" class="status" hidden>Recording: <span>0:00</span></div>
                        <div id="playback3c" class="playback" hidden>
                            <audio controls></audio>
                            <button class="retry-btn secondary-btn" aria-label="Retry recording your street address" type="button">Retry</button>
                            <button id="submitGrievanceBtn" class="next-btn primary-btn" aria-label="Submit your grievance" type="button">Submit Grievance</button>
                        </div>
                    </div>
                </div>
            </form>

            <!-- Confirmation and Attachments Step -->
            <div id="confirmation" class="step" hidden role="region" aria-labelledby="confirmation-heading">
                <h2 id="confirmation-heading">Voice Grievance Submitted</h2>
                <div class="content">
                    <p id="resultMessage">Your voice recordings have been submitted successfully.</p>
                    <p id="grievanceId">Your grievance ID is <span></span></p>
                    <p>Please save this ID for your reference.</p>
                    
                    <div class="attachment-section">
                        <h3>Attachment Options</h3>
                        <div class="attachment-instructions" id="attachmentInstructions">
                            <p>You can attach photos or documents to provide more details about your grievance.</p>
                            <p>This step is optional but recommended to help us better understand your issue.</p>
                            <div class="button-container">
                                <button id="attachFilesBtn" class="secondary-btn" aria-label="Attach photos or documents" type="button">Attach Files</button>
                            </div>
                        </div>
                        
                        <div class="file-upload-container">
                            <input type="file" id="fileInput" multiple accept="image/*,application/pdf,video/*,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.txt" hidden>
                            <div id="fileList" class="file-list" hidden>
                                <h3>Selected Files:</h3>
                                <ul></ul>
                                <button id="submitFilesBtn" class="secondary-btn" aria-label="Submit your selected files" type="button">Submit Files</button>
                            </div>
                        </div>
                        
                        <div id="uploadedFilesSection" class="uploaded-files-section" hidden>
                            <h3>Uploaded Files</h3>
                            <div id="uploadedFilesList" class="uploaded-files-list">
                                <ul></ul>
                            </div>
                            <p class="upload-success-message" id="uploadSuccessMessage">Files uploaded successfully!</p>
                            <div class="button-container">
                                <button id="attachMoreBtn" class="secondary-btn" aria-label="Attach more files" type="button">Attach More Files</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="button-container">
                        <button id="newBtn" class="primary-btn" aria-label="Start a new grievance report" type="button">New Grievance</button>
                        <button id="exitBtn" class="exit-btn" aria-label="Exit application" type="button">Exit</button>
                    </div>
                </div>
            </div>
        </main>

        <!-- Ensure the help dialog is properly set up to work with showModal() -->
        <dialog id="helpDialog" aria-labelledby="helpDialogHeading">
            <h2 id="helpDialogHeading">Help & Instructions</h2>
            <p>Record your grievance in these steps:</p>
            <ol>
                <li>Explain your grievance</li>
                <li>Provide your full name</li>
                <li>Provide your phone number</li>
                <li>State your municipality</li>
                <li>State your village</li>
                <li>State your street address</li>
                <li>Submit your grievance</li>
                <li>Optionally attach supporting files</li>
            </ol>
            <p>Accessibility features available:</p>
            <ul>
                <li>Use the "Read Aloud" button (üîä) to hear page contents</li>
                <li>Change speech rate with the "1x" button</li>
                <li>Increase font size with the "Aa" button</li>
                <li>Toggle high contrast mode with the contrast button (‚óê)</li>
            </ul>
            <button class="primary-btn" aria-label="Close help dialog" type="button">Close</button>
        </dialog>
        
        <!-- Screen Reader Enable Dialog -->
        <dialog id="screenReaderDialog" aria-labelledby="screenReaderDialogHeading">
            <h2 id="screenReaderDialogHeading">Enable Screen Reader?</h2>
            <p>Would you like to enable the Screen Reader (Read Aloud) feature for this session? This will allow the app to read instructions aloud for each step.</p>
            <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                <button id="enableScreenReaderBtn" class="primary-btn" aria-label="Enable screen reader">Enable</button>
                <button id="disableScreenReaderBtn" class="secondary-btn" aria-label="Do not enable screen reader">Not Now</button>
            </div>
        </dialog>
        
        <footer>
            <div class="footer-content">
                <p>&copy; 2025 Department of Roads, Nepal. All rights reserved.</p>
                
                <!-- Accessibility Toolbar in Footer -->
                <div class="accessibility-toolbar" role="toolbar" aria-label="Accessibility controls">
                    <button id="contrastToggleBtn" class="a11y-btn contrast-btn" aria-label="Toggle high contrast mode" type="button">
                        <span class="icon" aria-hidden="true">‚óê</span>
                    </button>
                    
                    <button id="fontSizeBtn" class="a11y-btn font-btn" aria-label="Increase font size" type="button">
                        <span class="icon" aria-hidden="true">Aa</span>
                    </button>
                    
                    <button id="readPageBtn" class="a11y-btn read-btn" aria-label="Read page content aloud" type="button">
                        <span class="icon" aria-hidden="true">üîä</span>
                    </button>
                    
                    <button id="speedBtn" class="a11y-btn speed-btn" aria-label="Change speech rate" type="button">
                        <span class="icon" aria-hidden="true">1x</span>
                    </button>
                    
                    <button id="helpBtn" class="a11y-btn help-btn" aria-label="Show help and instructions" type="button">
                        <span class="icon" aria-hidden="true">?</span>
                    </button>
                </div>
            </div>
        </footer>

        <!-- Add after the main content, before the footer -->
        <div id="submissionOverlay" class="submission-overlay" hidden data-debug="submission-overlay">
            <div class="submission-content">
                <div class="spinner"></div>
                <div class="submission-message">Submitting your grievance‚Ä¶</div>
                <button id="cancelSubmissionBtn" class="secondary-btn" style="display:none; margin-top:20px;">Cancel</button>
            </div>
        </div>
    </div>

    <script src="/shared/scripts/utils.js"></script>
    <script src="/accessible/config.js"></script>
    <script src="/accessible/app.js"></script>
</body>
</html> 
version: "3.1"

rules:

  - rule: Say goodbye anytime the user says goodbye
    steps:
      - intent: goodbye
      - action: utter_goodbye

  - rule: Respond to user challenge
    steps:
      - intent: bot_challenge
      - action: action_respond_to_challenge

  - rule: Respond to user stating their great mood
    steps:
      - intent: mood_great
      - action: action_handle_mood_great

  - rule: User files the grievance as is
    steps:
      - intent: submit_grievance_as_is
      - action: action_submit_grievance_as_is

  - rule: Exit grievance filing at any time
    steps:
      - intent: exit_without_filing
      - action: utter_exit_without_filing
      - active_loop: null

  - rule: Implementation of the Two-Stage-Fallback
    steps:
    - intent: nlu_fallback
    - action: action_default_fallback

  - rule: Happy path for grievance filing
    steps:
      - intent: start_grievance_process
      - slot_was_set:
        - main_story: "new_grievance"
      - action : action_start_grievance_process
      - action : grievance_details_form
      - active_loop: grievance_details_form
      - active_loop: null
      - action: grievance_summary_form
      - active_loop: grievance_summary_form
      - active_loop: null
      - slot_was_set:
        - user_location_consent: null
      - action: location_form
      - active_loop: location_form
      - active_loop: null
      - action: contact_form
      - active_loop: contact_form
      - slot_was_set:
        - user_contact_consent: true
        - phone_validation_required: true
      - active_loop: null
      - action: otp_verification_form
      - active_loop: otp_verification_form
      - active_loop: null
      - action: action_submit_grievance


  - rule: User files grievance without contact consent
    steps:
      - slot_was_set:
        - main_story: "new_grievance"
      - action: contact_form
      - active_loop: contact_form
      - slot_was_set:
        - user_contact_consent: false
        - phone_validation_required: false
      - active_loop: null
      - action: action_submit_grievance

  - rule: User files grievance without contact phone
    steps:
      - slot_was_set:
        - main_story: "new_grievance"
      - action: contact_form
      - active_loop: contact_form
      - slot_was_set:
        - user_contact_consent: true  
        - phone_validation_required: false
      - active_loop: null
      - action: action_submit_grievance
      